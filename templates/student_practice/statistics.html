{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Code Online Judge - Learning Statistics">
    <title>Learning Statistics - Code Online Judge</title>
    <!-- Preload key resources -->
    <link rel="preload" href="{% static 'layui-v2.11.4/layui/css/layui.css' %}" as="style">
    <link rel="preload" href="{% static 'js/jquery-3.7.1.js' %}" as="script">
    <link rel="preload" href="{% static 'layui-v2.11.4/layui/layui.js' %}" as="script">
    <!-- Import stylesheets -->
    <link rel="stylesheet" href="{% static 'layui-v2.11.4/layui/css/layui.css' %}">
    <!-- Add page cache control -->
    <meta http-equiv="Cache-Control" content="max-age=300">
    <!-- Direct import of ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --light-gray: #f5f7fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --text-dark: #343a40;
            --text-light: #6c757d;
            --accent-color: #5c7cfa;
            --border-color: #dee2e6;
            --hover-bg: #e2e6ea;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        /* Elegant gray-white navigation bar style */
        .header {
            background-color: white;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            color: var(--text-dark);
            font-size: 22px;
            font-weight: 600;
            text-decoration: none;
        }

        .logo i {
            margin-right: 12px;
            font-size: 26px;
            color: var(--accent-color);
            background: linear-gradient(135deg, var(--accent-color), #748ffc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .content {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 30px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .breadcrumb {
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-color);
        }

        .breadcrumb a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .stats-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #5c7cfa, #748ffc);
        }

        .stats-card-title {
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stats-card-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--accent-color);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
        }

        .stats-card-subtitle {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Different colored stats cards */
        .stats-card-primary::before {
            background: linear-gradient(135deg, #5c7cfa, #748ffc);
        }

        .stats-card-success::before {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .stats-card-warning::before {
            background: linear-gradient(135deg, #fd7e14, #ffc107);
        }

        .stats-card-info::before {
            background: linear-gradient(135deg, #17a2b8, #20c997);
        }

        .stats-card-purple::before {
            background: linear-gradient(135deg, #6f42c1, #9c88ff);
        }

        .stats-card-teal::before {
            background: linear-gradient(135deg, #20c997, #17a2b8);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .difficulty-progress {
            margin-bottom: 30px;
        }

        .difficulty-bars {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .difficulty-bar {
            display: flex;
            align-items: center;
        }

        .difficulty-label {
            width: 60px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .progress-container {
            flex: 1;
            height: 24px;
            background-color: var(--light-gray);
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            color: white;
            text-align: center;
            line-height: 24px;
            font-weight: 500;
            border-radius: 12px;
            transition: width 0.5s ease;
        }

        .charts-section {
            margin-bottom: 30px;
        }

        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            height: 400px;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-color);
        }

        .recent-activity {
            margin-top: 30px;
        }

        .activity-table {
            width: 100%;
            border-collapse: collapse;
        }

        .activity-table th, .activity-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .activity-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: var(--text-dark);
        }

        .activity-table tr:hover {
            background-color: var(--light-gray);
        }

        .status-accepted {
            color: #28a745;
        }

        .status-wrong {
            color: #dc3545;
        }

        .summary-box {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .summary-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .summary-content {
            color: var(--text-light);
            line-height: 1.6;
        }

        .highlight {
            color: var(--accent-color);
            font-weight: 500;
        }

        .footer {
            background-color: white;
            color: var(--text-light);
            text-align: center;
            padding: 25px 15px;
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            font-size: 15px;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tag {
            background-color: var(--light-gray);
            color: var(--text-dark);
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .tag:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .tag-count {
            background-color: white;
            color: var(--text-dark);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .content {
                margin: 20px auto;
                padding: 0 15px;
            }

            .card {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-row {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }
        }
        
        /* Debug information panel style */
        #debug-info {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        #debug-info h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        #debug-content p {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="nav-container">
            <a href="/" class="logo">
                <i class="layui-icon layui-icon-code-circle"></i>
                Code Online Judge(LCTC)
            </a>
        </div>
    </header>

    <div class="content">
        <!-- Breadcrumb navigation -->
        <div class="breadcrumb">
            <span><a href="/">Home</a></span>
            <span> / </span>
            <span><a href="{% url 'student_practice:problem_list' %}">Practice Problems</a></span>
            <span> / </span>
            <span>Learning Statistics</span>
        </div>

        <!-- Statistics overview card -->
        <div class="card">
            <div class="stats-header">
                <h1 class="stats-title">Learning Statistics Overview</h1>
            </div>

            <!-- Learning summary -->
            <div class="summary-box">
                <div class="summary-title">Learning Progress Summary</div>
                <div class="summary-content">
                    You have solved <span class="highlight">{{ stats.solved_problems }}</span> problems,
                    which is <span class="highlight">{{ stats.solved_problems|floatformat:1 }}%</span> of the total problem set.
                    Your average success rate is <span class="highlight">{{ stats.success_rate }}%</span>,
                    with a streak of <span class="highlight">{{ stats.consecutive_days }}</span> consecutive days.
                    In terms of difficulty distribution, you have completed <span class="highlight">{{ stats.easy_solved }}</span> easy problems,
                    <span class="highlight">{{ stats.medium_solved }}</span> medium problems,
                    and <span class="highlight">{{ stats.hard_solved }}</span> hard problems.
                    Keep it up and challenge more problems!
                </div>
            </div>
            
            <!-- Learning suggestions -->
            <div class="summary-box" style="border-left-color: #20c997;">
                <div class="summary-title">Personalized Learning Suggestions</div>
                <div class="summary-content">
                    {% if stats.solved_problems < 10 %}
                        <p>You're just starting your programming journey. We recommend focusing on more <span class="highlight">easy problems</span> to build a solid foundation.</p>
                    {% elif stats.medium_solved < 5 %}
                        <p>You've mastered the basics. Now try challenging yourself with more <span class="highlight">medium difficulty</span> problems to improve your problem-solving skills.</p>
                    {% elif stats.hard_solved < 3 %}
                        <p>Your problem-solving skills are quite good. We suggest trying some <span class="highlight">hard problems</span> to further enhance your abilities.</p>
                    {% else %}
                        <p>You're already an advanced problem solver! Try more diverse types of problems to expand your knowledge.</p>
                    {% endif %}
                    
                    {% if stats.consecutive_days < 3 %}
                        <p>Solving problems daily can better improve your programming skills. We recommend maintaining a <span class="highlight">consistent learning</span> habit.</p>
                    {% else %}
                        <p>You've been learning consistently for {{ stats.consecutive_days }} days, which is excellent! Keep up this learning habit.</p>
                    {% endif %}
                    
                    {% if stats.success_rate < 50 %}
                        <p>Your success rate is relatively low. We suggest checking your code more thoroughly before submitting, or testing it locally first.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Statistics data cards -->
            <div class="stats-grid">
                <div class="stats-card stats-card-primary">
                    <div class="stats-card-title">Total Problems</div>
                    <div class="stats-card-value" style="color: #5c7cfa;">{{ stats.total_problems }}</div>
                </div>
                <div class="stats-card stats-card-success">
                    <div class="stats-card-title">Completed Problems</div>
                    <div class="stats-card-value" style="color: #28a745;">{{ stats.solved_problems }}</div>
                    <div class="stats-card-subtitle">{{ stats.solved_problems|floatformat:1 }}% of total</div>
                </div>
                <div class="stats-card stats-card-warning">
                    <div class="stats-card-title">Attempted Problems</div>
                    <div class="stats-card-value" style="color: #fd7e14;">{{ stats.attempted_problems }}</div>
                    <div class="stats-card-subtitle">{{ stats.attempted_problems|add:"-"|add:stats.solved_problems }} incomplete</div>
                </div>
                <div class="stats-card stats-card-info">
                    <div class="stats-card-title">Success Rate</div>
                    <div class="stats-card-value" style="color: #17a2b8;">{{ stats.success_rate }}%</div>
                    <div class="stats-card-subtitle">{{ stats.total_submissions }} total submissions</div>
                </div>
                <div class="stats-card stats-card-purple">
                    <div class="stats-card-title">Consecutive Days</div>
                    <div class="stats-card-value" style="color: #6f42c1;">{{ stats.consecutive_days }}</div>
                    <div class="stats-card-subtitle">Best: {{ stats.best_streak }} days</div>
                </div>
                <div class="stats-card stats-card-teal">
                    <div class="stats-card-title">Untried Problems</div>
                    <div class="stats-card-value" style="color: #20c997;">{{ stats.untried_problems }}</div>
                    <div class="stats-card-subtitle">{{ stats.untried_problems|floatformat:1 }}% of total</div>
                </div>
            </div>

            <!-- Difficulty completion status -->
            <div class="difficulty-progress">
                <h3 class="section-title">Difficulty Completion Status</h3>
                <div class="difficulty-bars">
                    <div class="difficulty-bar">
                        <div class="difficulty-label">Easy</div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: {{ stats.easy_solved|floatformat:1 }}%; background-color: #28a745;">
                                {{ stats.easy_solved }}
                            </div>
                        </div>
                    </div>
                    <div class="difficulty-bar">
                        <div class="difficulty-label">Medium</div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: {{ stats.medium_solved|floatformat:1 }}%; background-color: #fd7e14;">
                                {{ stats.medium_solved }}
                            </div>
                        </div>
                    </div>
                    <div class="difficulty-bar">
                        <div class="difficulty-label">Hard</div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: {{ stats.hard_solved|floatformat:1 }}%; background-color: #dc3545;">
                                {{ stats.hard_solved }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Knowledge point distribution -->
            <div class="tag-section">
                <h3 class="section-title">Knowledge Point Distribution</h3>
                <div class="tag-cloud" id="tagCloud">
                    <div style="color: var(--text-light); padding: 10px;">
                        Based on the types of problems you've solved, the system will display your knowledge point distribution. Continue solving more diverse problems to enrich your knowledge map!
                    </div>
                </div>
            </div>

            <!-- Chart area -->
            <div class="charts-section">
                <h3 class="section-title">Data Visualization</h3>
                <!-- Debug information panel -->
                <div id="debug-info" style="display: none;">
                    <h4>Debug Information</h4>
                    <div id="debug-content"></div>
                </div>
                <div class="charts-row">
                    <!-- Difficulty distribution chart -->
                    <div class="chart-container" id="difficultyChart"></div>
                    
                    <!-- Problem type distribution chart -->
                    <div class="chart-container" id="problemTypeChart"></div>
                </div>
                
                <!-- Daily submission chart -->
                <div class="chart-container" id="submissionChart"></div>
                
                <!-- Learning progress trend chart -->
                <div class="chart-container" id="progressTrendChart"></div>
            </div>

            <!-- Recent activity -->
            <div class="recent-activity">
                <h3 class="section-title">Recent Submission Records</h3>
                <table class="activity-table">
                    <thead>
                        <tr>
                            <th>Submission Time</th>
                            <th>Problem</th>
                            <th>Language</th>
                            <th>Status</th>
                            <th>Execution Time</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in recent_submissions %}
                        <tr>
                            <td>{{ submission.created_at|date:"Y-m-d H:i:s" }}</td>
                            <td><a href="{% url 'student_practice:problem_detail' submission.problem.id %}">{{ submission.problem.title }}</a></td>
                            <td>{{ submission.get_language_display }}</td>
                            <td>
                                {% if submission.status == 'accepted' %}
                                <span class="status-accepted"><i class="layui-icon layui-icon-ok-circle"></i> Accepted</span>
                                {% else %}
                                <span class="status-wrong"><i class="layui-icon layui-icon-close-fill"></i> {{ submission.get_status_display }}</span>
                                {% endif %}
                            </td>
                            <td>{{ submission.execution_time }} ms</td>
                            <td>
                                <a href="{% url 'student_practice:submission_detail' submission.id %}" class="layui-btn layui-btn-xs">Details</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 30px;">No submission records yet</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="footer">
        Â© 2025 Code Online Judge Copyright | Elegant code review platform
    </footer>

    <!-- Import jQuery first -->
    <script src="{% static 'js/jquery-3.7.1.js' %}"></script>
    <!-- Then import Layui -->
    <script src="{% static 'layui-v2.11.4/layui/layui.js' %}"></script>
    <script>
        layui.use(['layer'], function() {
            var layer = layui.layer;
            
            // Ensure all JSON data is correctly parsed
            var dailySubmissions, dailyAccepted, submissionDates, submissionCounts, acceptedCounts;
            var typeDistribution, difficultyData;
            
            try {
                // Parse JSON data with error handling
                dailySubmissions = JSON.parse('{{ daily_submissions|safe }}'.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
                dailyAccepted = JSON.parse('{{ daily_accepted|safe }}'.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
                submissionDates = Object.keys(dailySubmissions);
                submissionCounts = Object.values(dailySubmissions);
                acceptedCounts = Object.values(dailyAccepted);
                
                typeDistribution = JSON.parse('{{ type_distribution|safe }}'.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
                difficultyData = JSON.parse('{{ difficulty_data|safe }}'.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
                
                console.log("Data loaded successfully:", {
                    dailySubmissions: dailySubmissions,
                    dailyAccepted: dailyAccepted,
                    typeDistribution: typeDistribution,
                    difficultyData: difficultyData
                });
            } catch (e) {
                console.error('Data parsing error:', e);
                $("#debug-content").append("<p style='color:red'>Error parsing data: " + e.message + "</p>");
                
                // Provide default data in case parsing fails
                dailySubmissions = {'2023-07-28': 5, '2023-07-29': 3, '2023-07-30': 4};
                dailyAccepted = {'2023-07-28': 3, '2023-07-29': 2, '2023-07-30': 2};
                submissionDates = Object.keys(dailySubmissions);
                submissionCounts = Object.values(dailySubmissions);
                acceptedCounts = Object.values(dailyAccepted);
                
                typeDistribution = {"Algorithms": 5, "Data Structures": 3, "Mathematics": 2, "String": 4, "Dynamic Programming": 1};
                difficultyData = {easy: 3, medium: 2, hard: 1};
                
                // Show debug panel in case of error
                $("#debug-info").show();
            }
            
            // Prepare problem type distribution data
            var problemTypes = [];
            var typeColors = ['#5c7cfa', '#28a745', '#fd7e14', '#dc3545', '#6f42c1', '#20c997', '#6610f2'];
            var colorIndex = 0;
            
            for (var type in typeDistribution) {
                problemTypes.push({
                    value: typeDistribution[type],
                    name: type,
                    itemStyle: {color: typeColors[colorIndex % typeColors.length]}
                });
                colorIndex++;
            }
            
            // Generate knowledge point distribution
            var tagCloud = document.getElementById('tagCloud');
            if (tagCloud) {
                // Clear existing content
                tagCloud.innerHTML = '';
                
                var tagColors = ['#5c7cfa', '#28a745', '#fd7e14', '#dc3545', '#6f42c1', '#20c997', '#6610f2'];
                var tagIndex = 0;
                
                // Use problem type distribution data as knowledge points display
                for (var type in typeDistribution) {
                    var tagElement = document.createElement('div');
                    tagElement.className = 'tag';
                    tagElement.style.backgroundColor = tagColors[tagIndex % tagColors.length];
                    tagElement.style.color = 'white';
                    
                    tagElement.innerHTML = type + '<span class="tag-count">' + typeDistribution[type] + '</span>';
                    tagCloud.appendChild(tagElement);
                    
                    tagIndex++;
                }
                
                // If no data, display a prompt message
                if (tagIndex === 0) {
                    var noTagsElement = document.createElement('div');
                    noTagsElement.style.color = 'var(--text-light)';
                    noTagsElement.style.padding = '10px';
                    noTagsElement.textContent = 'No knowledge point data yet. Please continue solving more diverse problems.';
                    tagCloud.appendChild(noTagsElement);
                }
            }
            
            // Ensure charts are initialized immediately after page loads
            $(document).ready(function() {
                console.log("Page loaded, initializing charts");
                
                // Display debug information
                $("#debug-content").html("<p>Initializing charts...</p>");
                $("#debug-content").append("<p>Difficulty data: " + JSON.stringify(difficultyData) + "</p>");
                $("#debug-content").append("<p>Problem type data: " + JSON.stringify(typeDistribution) + "</p>");
                $("#debug-content").append("<p>Date data: " + submissionDates.length + " days</p>");
                
                try {
                    // Initialize difficulty distribution chart with responsive handling
                    var difficultyChartContainer = document.getElementById('difficultyChart');
                    var difficultyChart = echarts.init(difficultyChartContainer);
                    
                    // Check if container exists and has dimensions
                    if (!difficultyChartContainer || 
                        difficultyChartContainer.offsetHeight === 0 || 
                        difficultyChartContainer.offsetWidth === 0) {
                        throw new Error("Chart container has zero dimensions or doesn't exist");
                    }
                    
                    var difficultyOption = {
                        title: {
                            text: 'Difficulty Distribution',
                            left: 'center',
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b}: {c} ({d}%)',
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: '#ccc',
                            borderWidth: 1,
                            textStyle: {
                                color: '#333'
                            }
                        },
                        legend: {
                            orient: 'horizontal',
                            bottom: 10,
                            data: ['Easy', 'Medium', 'Hard'],
                            textStyle: {
                                fontSize: 12
                            }
                        },
                        series: [
                            {
                                name: 'Difficulty Distribution',
                                type: 'pie',
                                radius: '55%',
                                center: ['50%', '50%'],
                                data: [
                                    {value: difficultyData.easy || 0, name: 'Easy', itemStyle: {color: '#28a745'}},
                                    {value: difficultyData.medium || 0, name: 'Medium', itemStyle: {color: '#fd7e14'}},
                                    {value: difficultyData.hard || 0, name: 'Hard', itemStyle: {color: '#dc3545'}}
                                ],
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                },
                                label: {
                                    formatter: '{b}: {c} ({d}%)',
                                    fontSize: 12
                                },
                                animationType: 'scale',
                                animationEasing: 'elasticOut',
                                animationDelay: function (idx) {
                                    return Math.random() * 200;
                                }
                            }
                        ]
                    };
                    difficultyChart.setOption(difficultyOption);
                    $("#debug-content").append("<p>Difficulty distribution chart initialized successfully</p>");
                    
                    // Initialize daily submission chart
                    var submissionChart = echarts.init(document.getElementById('submissionChart'));
                    var submissionOption = {
                        title: {
                            text: 'Daily Submission Statistics',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow'
                            }
                        },
                        legend: {
                            data: ['Total Submissions', 'Accepted Submissions'],
                            bottom: 10
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '15%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            data: submissionDates,
                            axisLabel: {
                                rotate: 45,
                                interval: 'auto',
                                formatter: function(value) {
                                    // Simplify date display, only show month and day
                                    return value.substring(5);
                                }
                            }
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: 'Total Submissions',
                                type: 'bar',
                                data: submissionCounts,
                                itemStyle: {
                                    color: '#5c7cfa'
                                }
                            },
                            {
                                name: 'Accepted Submissions',
                                type: 'bar',
                                data: acceptedCounts,
                                itemStyle: {
                                    color: '#28a745'
                                }
                            }
                        ]
                    };
                    submissionChart.setOption(submissionOption);
                    $("#debug-content").append("<p>Daily submission chart initialized successfully</p>");
                    
                    // Initialize problem type distribution chart
                    var problemTypeChart = echarts.init(document.getElementById('problemTypeChart'));
                    var problemTypeOption = {
                        title: {
                            text: 'Problem Type Distribution',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b}: {c} ({d}%)'
                        },
                        legend: {
                            orient: 'horizontal',
                            bottom: 10,
                            type: 'scroll',
                            pageIconSize: 12
                        },
                        series: [
                            {
                                name: 'Problem Type Distribution',
                                type: 'pie',
                                radius: '50%',
                                center: ['50%', '50%'],
                                data: problemTypes,
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                },
                                label: {
                                    formatter: '{b}: {c} ({d}%)'
                                }
                            }
                        ]
                    };
                    problemTypeChart.setOption(problemTypeOption);
                    $("#debug-content").append("<p>Problem type distribution chart initialized successfully</p>");
                    
                    // Initialize learning progress trend chart
                    var progressTrendChart = echarts.init(document.getElementById('progressTrendChart'));
                    
                    // Generate date array for the past 30 days
                    var dateArray = Object.keys(dailySubmissions);
                    var cumulativeSolved = 0;
                    var progressData = [];
                    
                    // Calculate cumulative solved problems
                    for (var i = 0; i < dateArray.length; i++) {
                        var date = dateArray[i];
                        cumulativeSolved += dailyAccepted[date] > 0 ? 1 : 0; // If there are accepted submissions on that day, increment problem count
                        progressData.push(cumulativeSolved);
                    }
                    
                    var progressOption = {
                        title: {
                            text: 'Learning Progress Trend',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis',
                            formatter: function(params) {
                                var date = params[0].name;
                                var value = params[0].value;
                                return date + '<br/>Cumulative solved problems: ' + value;
                            }
                        },
                        xAxis: {
                            type: 'category',
                            data: dateArray,
                            axisLabel: {
                                rotate: 45,
                                interval: 'auto',
                                formatter: function(value) {
                                    return value.substring(5);
                                }
                            }
                        },
                        yAxis: {
                            type: 'value',
                            name: 'Cumulative Solved Problems',
                            nameLocation: 'middle',
                            nameGap: 40
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '15%',
                            containLabel: true
                        },
                        series: [
                            {
                                name: 'Cumulative Solved Problems',
                                type: 'line',
                                data: progressData,
                                smooth: true,
                                lineStyle: {
                                    width: 3,
                                    color: '#5c7cfa'
                                },
                                itemStyle: {
                                    color: '#5c7cfa'
                                },
                                areaStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        {
                                            offset: 0,
                                            color: 'rgba(92, 124, 250, 0.5)'
                                        },
                                        {
                                            offset: 1,
                                            color: 'rgba(92, 124, 250, 0.1)'
                                        }
                                    ])
                                },
                                markPoint: {
                                    data: [
                                        { type: 'max', name: 'Maximum' }
                                    ]
                                }
                            }
                        ]
                    };
                    
                    progressTrendChart.setOption(progressOption);
                    $("#debug-content").append("<p>Learning progress trend chart initialized successfully</p>");
                    
                    // Resize charts when window size changes
                    window.addEventListener('resize', function() {
                        difficultyChart.resize();
                        submissionChart.resize();
                        problemTypeChart.resize();
                        progressTrendChart.resize();
                    });
                    
                    // Display debug panel (visible in development environment, hidden in production)
                    // $("#debug-info").show();
                } catch (e) {
                    console.error("Chart initialization error:", e);
                    $("#debug-content").append("<p style='color:red'>Error: " + e.message + "</p>");
                    $("#debug-info").show();
                }
            });
        });
    </script>
</body>
</html>
